---
layout: post
title: "编程新技术实务2"
subtitle: '前后端分离实现后台管理系统，并部署到服务器'
author: "Tang Jibin"
header-img: img/header/2021-11-2-lab-blog.png #不需要加图片就用 header-img: text
#header-img-credit: CG #在图片右下角加 credit
header-mask: 0.5 #表示图片的阴影指数，只在标题加图片才需要
hidden: false
mathjax: false
mermaid: false
tags:
  - Java
  - SpringBoot
  - Vue
  - server
  - Lab
---

## 前言

其实实验二我早就已经完成了，但是最近实在没有时间，所以今天才更新博客 :expressionless:
我是第一个验收实验二的，允许验收实验二的第一堂课我就去验收了，最后也是**拿到了最高评级 A+** （这里还是要吐槽一句为什么最高评级都只有 95 ，就不能给 100 吗 :triumph:）
你可以通过超链接来访问[我的后台管理系统](http://120.25.234.241:8080/admin)，不过等你看到这篇博文的时候，应该已经访问不了了（不要问我为什么，因为穷，服务器是白嫖的第一个月），先来看看效果咋样吧

- 登录界面：

![](/img/in-post/2021-11-2-lab-blog/1.png)

- users 界面：

![](/img/in-post/2021-11-2-lab-blog/2.png)

- person 界面：

![](/img/in-post/2021-11-2-lab-blog/3.png)

其他还有很多小功能，可以访问[我的后台管理系统](http://120.25.234.241:8080/admin)来体验，也可以 clone 我的 [GitHub 项目](https://github.com/tjbnbb/LAB1_2)在本地运行，觉得还行的话欢迎 star :star: 和 fork :heart:

## 实验内容

实验的大致内容是

>编写web页面，完成对实验一数据库的操作

但是如果按照实验文档中的去写实在太垃圾了，感觉有点跟不上时代了，所以我打算用目前前端最主流的框架—— Vue ，怎么安装的就不打算说，谷歌百度一大堆

本来想自己写布局和页面的，但是前端重复造轮子的东西实在太多，不如用别人的项目模板进行修改，所以我这里用的基础 Vue 模板是 [PanJiaChen](https://github.com/PanJiaChen) 大佬的 [vue-admin-template](https://github.com/PanJiaChen/vue-admin-template) 模板，**感谢 [PanJiaChen](https://github.com/PanJiaChen) 大佬开源了这么简洁但又好看的 Vue 模板**

## 实验过程

### 步骤一 完成后端 service 层

首先我们先完成 SpringBoot 项目中要给 controller 层提供服务的 service 层，我们在这里将接口和实现放入两个包，接口放入 service 包，实现放入 servicelmpl 包，这样显得更加清晰明了，如下图所示：

![](/img/in-post/2021-11-2-lab-blog/4.png)

具体实现如下：（有些服务 contoller 层不一定会用到，但我们先写上去）

PersonService.java：
```java
package com.tjb.backend.service;

import com.github.pagehelper.PageInfo;
import com.tjb.backend.bean.PersonBean;

import java.util.List;

public interface PersonService {

    int createPersontable();

    int insertPerson(PersonBean personBean);

    int deletePerson(String usersname);

    int deletebeginPerson(String usersname);

    int updatePerson(PersonBean personBean);

    List<PersonBean> getPerson(String usersname);

    List<PersonBean> getlikePerson(String usersname);

    List<PersonBean> getAllPerson();

    //分页查询
    PageInfo<PersonBean> getPageInfo(int page, int limit, String username, String type);

    int dropPersontable();

}
```

UsersService.java：
```java
package com.tjb.backend.service;

import com.github.pagehelper.PageInfo;
import com.tjb.backend.bean.UsersBean;

import java.util.List;

public interface UsersService {

    int createUserstable();

    int insertUsers(UsersBean usersBean);

    int deleteUsers(String usersname);

    int deletebeginUsers(String usersname);

    int updateUsers(UsersBean usersBean);

    List<UsersBean> getUsers(String usersname);

    List<UsersBean> getlikeUsers(String usersname);

    List<UsersBean> getAllUsers();

    //分页查询
    PageInfo<UsersBean> getPageInfo(int page, int limit, String username, String type);

    int dropUserstable();

}
```

PersonServicelmpl.java
```java
package com.tjb.backend.servicelmpl;

import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import com.tjb.backend.bean.PersonBean;
import com.tjb.backend.bean.UsersBean;
import com.tjb.backend.mapper.PersonMapper;
import com.tjb.backend.mapper.UsersMapper;
import com.tjb.backend.service.PersonService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@Transactional
public class PersonServicelmpl implements PersonService {

    @Autowired
    UsersMapper usersMapper;

    @Autowired
    PersonMapper personMapper;

    @Override
    public int createPersontable() {
        return personMapper.createPersontable();
    }

    @Override
    public int insertPerson(PersonBean personBean) {
        if((usersMapper.getlikeUsers(personBean.getUsername())).isEmpty()) {
            usersMapper.insertUsers(new UsersBean(personBean.getUsername(),"888888"));
        }
        return personMapper.insertPerson(personBean);
    }

    @Override
    public int deletePerson(String usersname) {
        return personMapper.deletelikePerson(usersname);
    }

    @Override
    public int deletebeginPerson(String usersname) {
        return personMapper.deletelikePerson(usersname + "%");
    }

    @Override
    public int updatePerson(PersonBean personBean) {
        return personMapper.updatePerson(personBean);
    }

    @Override
    public List<PersonBean> getPerson(String usersname) {
        return personMapper.getlikePerson(usersname);
    }

    @Override
    public List<PersonBean> getlikePerson(String usersname) {
        return personMapper.getlikePerson("%" + usersname + "%");
    }

    @Override
    public List<PersonBean> getAllPerson() {
        return personMapper.getAllPerson();
    }

    @Override
    //分页查询
    public PageInfo<PersonBean> getPageInfo(int page, int limit, String username, String type) {
        PageHelper.startPage(page, limit,true);
        List<PersonBean> person;
        if(username == null || username.equals("") || type == null || type.equals("")) person = personMapper.getAllPerson();
        else if(type.equals("exact")) person = personMapper.getlikePerson(username);
        else person = personMapper.getlikePerson("%" + username + "%");
        return new PageInfo<>(person);
    }

    @Override
    public int dropPersontable() {
        return personMapper.dropPersontable();
    }

}
```

UsersServicelmpl.java
```java
package com.tjb.backend.servicelmpl;

import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import com.tjb.backend.bean.UsersBean;
import com.tjb.backend.mapper.PersonMapper;
import com.tjb.backend.mapper.UsersMapper;
import com.tjb.backend.service.UsersService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.util.List;

@Service
@Transactional
public class UsersServicelmpl implements UsersService {

    @Autowired
    UsersMapper usersMapper;

    @Autowired
    PersonMapper personMapper;

    @Override
    public int createUserstable() {
        return usersMapper.createUserstable();
    }

    @Override
    public int insertUsers(UsersBean usersBean) {
        return usersMapper.insertUsers(usersBean);
    }

    @Override
    public int deleteUsers(String usersname) {
        if(personMapper.getlikePerson(usersname) != null) personMapper.deletelikePerson(usersname);
        return usersMapper.deletelikeUsers(usersname);
    }

    @Override
    public int deletebeginUsers(String usersname) {
        if(personMapper.getlikePerson(usersname + "%") != null) personMapper.deletelikePerson(usersname + "%");
        return usersMapper.deletelikeUsers(usersname + "%");
    }

    @Override
    public int updateUsers(UsersBean usersBean) {
        return usersMapper.updateUsers(usersBean);
    }

    @Override
    public List<UsersBean> getUsers(String usersname) {
        return usersMapper.getlikeUsers(usersname);
    }

    @Override
    public List<UsersBean> getlikeUsers(String usersname) {
        return usersMapper.getlikeUsers("%" + usersname + "%");
    }

    @Override
    public List<UsersBean> getAllUsers() {
        return usersMapper.getAllUsers();
    }

    @Override
    //分页查询
    public PageInfo<UsersBean> getPageInfo(int page, int limit, String username, String type) {
        PageHelper.startPage(page, limit,true);
        List<UsersBean> users;
        if(username == null || username.equals("") || type == null || type.equals("")) users = usersMapper.getAllUsers();
        else if(type.equals("exact")) users = usersMapper.getlikeUsers(username);
        else users = usersMapper.getlikeUsers("%" + username + "%");
        return new PageInfo<>(users);
    }

    @Override
    public int dropUserstable() {
        return usersMapper.dropUserstable();
    }

}
```

这里提供了模糊查询和精确查询的服务，并且使用了 PageHelper 插件提供分页服务，具体 PageHelper 是怎么样的话，可以去找官方文档

### 步骤二 删除前端项目通过模拟得到数据

接下来我们打开 vue-admin-template 项目，大致看一遍项目，了解一些项目的信息

我们可以发现项目通过 mock 文件夹里的文件来给项目提供模拟的数据，这样即使没有后端数据库的支撑，也是可以看到数据的，但都是随机模拟出来的

所以这里我们要做的第一步就是把 mock 文件夹删除，然后设置项目不要从 mock 文件夹里获取数据

打开项目中的 vue.config.js 文件，将标红部分删除

![](/img/in-post/2021-11-2-lab-blog/5.png)

并且在 open 后面改为 false，这里是为了编译启动项目时不要开两个网页

再打开 src 文件夹下的 main.js 文件，删除下面标红部分

![](/img/in-post/2021-11-2-lab-blog/6.png)

这样项目就不会使用前端的模拟数据了

还有一些要注意的要做，因为存在跨域资源请求的问题，前后端交互的网络请求在底层由 node.js 代理，所以我们要告诉前端项目后端项目的端口及它的项目根路径（设或者不设都可以，我在这里设置 /admin ），这样前端项目就会发送 url 请求给指定端口的根路径

打开根目录下的 vue.config.js 文件,在 devServer 中添加 proxy 区域的代码

```js
devServer: {
    port: port,
    open: false,
    overlay: {
      warnings: false,
      errors: true
    },
	// 代理所有以‘/admin’开头的网络请求
	proxy: {
      '/admin': {
        target: `http://localhost:8080/`, //后台服务地址（Springboot内置tomcat默认的地址）
        changeOrigin: true,
        pathRewrite: {
        // 路径重写，可以理解为路径重新赋值 
        // '^/admin': '/' 
        // pathRewrite: {'^/admin': '/'} 重写之后url为 http://localhost:8080/xxxx
        // pathRewrite: {'^/admin': '/admin'} 
        // 重写之后url为http://localhost:8080/admin/xxxx
        }
      }
    }
}
```

生产环境与开发环境通常有不同的服务地址。编辑 .env.development 以及 .env.production 这两个文件，修改其中的 VUE_APP_BASE_API

```js
VUE_APP_BASE_API = '/admin'
```

### 步骤三 完成后端项目 controller 层

打开 SpringBoot 项目中的 application.yml ，设置项目根路径为 /admin

![](/img/in-post/2021-11-2-lab-blog/7.png)

打开 Vue 项目的 src/utils/request.js ，它封装了一个 axios 请求对象，在这个项目的数据交互的请求都是基于 axios 来处理的。

我们可以在发送请求之前规定一些后端数据返回的格式，方便我们自己调试和定位网络请求是否正确响应和输出。比如根据服务端的状态码判断请求是否正常，若不正常给出相应的提示。

```js
response => {
    const res = response.data

    // if the custom code is not 20000, it is judged as an error.
    if (res.code !== 20000) {
      Message({
        message: res.message || 'Error',
        type: 'error',
        duration: 5 * 1000
      })

      // 50008: Illegal token; 50012: Other clients logged in; 50014: Token expired;
      if (res.code === 50008 || res.code === 50012 || res.code === 50014) {
        // to re-login
        MessageBox.confirm('You have been logged out, you can cancel to stay on this page, or log in again', 'Confirm logout', {
          confirmButtonText: 'Re-Login',
          cancelButtonText: 'Cancel',
          type: 'warning'
        }).then(() => {
          store.dispatch('user/resetToken').then(() => {
            location.reload()
          })
        })
      }
      return Promise.reject(new Error(res.message || 'Error'))
    } else {
      return res
    }
  },
  error => {
    console.log('err' + error) // for debug
    Message({
      message: error.message,
      type: 'error',
      duration: 5 * 1000
    })
    return Promise.reject(error)
  }
)
```

分析这段代码可以知道，返回数据要有一个 code 和一个 data ，code 是 20000 才说明没出错，data 就是本来要返回数据，所以我们在后端项目中的 controller 层使用 java 中 Map 来返回

接下来进行 controller 层的编写

首先写一个 LoginController.java 来提供 Vue 项目中的登录功能

LoginController.java
```java
package com.tjb.backend.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.ResponseBody;

import java.util.HashMap;
import java.util.Map;

@Controller
public class LoginController {
    @CrossOrigin
    @PostMapping(value = "/user/login")
    @ResponseBody
    public Map login() {
        HashMap<String, Object> response = new HashMap<>();
        HashMap<String, Object> responseData = new HashMap<>();
        responseData.put("token",1);
        response.put("code",20000);
        response.put("msg","success");
        response.put("data",responseData);
        return response;
    }

    @CrossOrigin
    @GetMapping(value = "/user/info")
    @ResponseBody
    public Map info() {
        HashMap<String, Object> responseInfo = new HashMap<>();
        HashMap<String, Object> responseData = new HashMap<>();
        responseData.put("roles","admin");
        responseData.put("name","Super admin,TJB");
        responseData.put("avatar","https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.zcool.cn%2Fcommunity%2F01237b5cd29ca8a801208f8b799f9b.gif&refer=http%3A%2F%2Fimg.zcool.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1636955518&t=17b1a571de56d3527a6d79b65f011672");
        responseInfo.put("code",20000);
        responseInfo.put("msg","success");
        responseInfo.put("data",responseData);
        return responseInfo;
    }

    @CrossOrigin
    @PostMapping(value = "/user/logout")
    @ResponseBody
    public Map logout() {
        HashMap<String, Object> response = new HashMap<>();
        HashMap<String, Object> responseData = new HashMap<>();
        response.put("code",20000);
        response.put("msg","success");
        return response;
    }
}
```

接下来编写给前端提供 users 表和 person 表的增删查改等功能的两个 controller

UsersController.java

```java
package com.tjb.backend.controller;

import com.github.pagehelper.PageInfo;
import com.tjb.backend.bean.UsersBean;
import com.tjb.backend.service.UsersService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/users")
public class UsersController {

    @Autowired
    private UsersService usersService;

    @CrossOrigin
    @PostMapping("/insertusers")
    public Map insertUsers(@RequestBody UsersBean usersBean) {
        usersService.insertUsers(usersBean);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data","success");
        return responseData;
    }

    @CrossOrigin
    @DeleteMapping("/deleteusers")
    public Map deleteUsers(@RequestParam("username") String username) {
        usersService.deleteUsers(username);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data","success");
        return responseData;
    }

    @DeleteMapping("/deletebeginusers")
    public boolean deletebeginUsers(@RequestParam("username") String username) {
        int tmp = usersService.deletebeginUsers(username);
        return tmp != 0;
    }

    @CrossOrigin
    @PutMapping("/updateusers")
    public Map updateUsers(@RequestBody UsersBean usersBean) {
        usersService.updateUsers(usersBean);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data","success");
        return responseData;
    }

    @GetMapping("/getusers")
    public List<UsersBean> getUsers(@RequestParam("username") String username) {
        return usersService.getUsers(username);
    }

    @GetMapping("/getlikeusers")
    public List<UsersBean> getlikeUsers(@RequestParam("username") String username) {
        return usersService.getlikeUsers(username);
    }

    @CrossOrigin
    @GetMapping("/getallusers")
    public Map getAllUsers() {
        List<UsersBean> usersList = usersService.getAllUsers();
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data",usersList);
        return responseData;
    }

    @CrossOrigin
    @GetMapping("/getPageInfo")
    public Map getPageInfo(@RequestParam("page") int page,@RequestParam("limit") int limit,
                           @RequestParam(value = "username",required = false) String username,
                           @RequestParam(value = "type",required = false) String type) {
        PageInfo<UsersBean> pageInfo = usersService.getPageInfo(page,limit,username,type);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data",pageInfo);
        return responseData;
    }

}
```

PersonController.java

```java
package com.tjb.backend.controller;

import com.github.pagehelper.PageInfo;
import com.tjb.backend.bean.PersonBean;
import com.tjb.backend.service.PersonService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/person")
public class PersonController {

    @Autowired
    private PersonService personService;

    @CrossOrigin
    @PostMapping("/insertperson")
    public Map insertPerson(@RequestBody PersonBean personBean) {
        personService.insertPerson(personBean);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data","success");
        return responseData;
    }

    @CrossOrigin
    @DeleteMapping("/deleteperson")
    public Map deletePerson(@RequestParam("username") String username) {
        personService.deletePerson(username);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data","success");
        return responseData;
    }

    @DeleteMapping("/deletebeginperson")
    public boolean deletebeginPerson(@RequestParam("username") String username) {
        int tmp = personService.deletebeginPerson(username);
        return tmp != 0;
    }

    @CrossOrigin
    @PutMapping("/updateperson")
    public Map updatePerson(@RequestBody PersonBean personBean) {
        personService.updatePerson(personBean);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data","success");
        return responseData;
    }

    @GetMapping("/getperson")
    public List<PersonBean> getPerson(@RequestParam("username") String username) {
        return personService.getPerson(username);
    }

    @GetMapping("/getlikeperson")
    public List<PersonBean> getlikeUsers(@RequestParam("username") String username) {
        return personService.getlikePerson(username);
    }

    @GetMapping("/getallperson")
    public List<PersonBean> getAllPerson() {
        return personService.getAllPerson();
    }

    @CrossOrigin
    @GetMapping("/getPageInfo")
    public Map getPageInfo(@RequestParam("page") int page,@RequestParam("limit") int limit,
                                            @RequestParam(value = "username",required = false) String username,
                                            @RequestParam(value = "type",required = false) String type) {
        PageInfo<PersonBean> pageInfo = personService.getPageInfo(page,limit,username,type);
        HashMap<String,Object> responseData = new HashMap<>();
        responseData.put("code",20000);
        responseData.put("data",pageInfo);
        return responseData;
    }

}
```

注解 `CrossOrigin` 是表示跨域的，因为前后端项目是不同的端口，其他的一些注解可以自行百度谷歌，要讲的话也有挺多的，反正都是声明给前端提供 url 的方式还有参数

到这里，后端项目就构建完成了


### 步骤五 部署项目到服务器

最后只剩将项目部署到服务器了，为了让大家不走弯路，这里我只介绍最简单的方法，我当初就是走了弯路，本来几十分钟的事搞了几个小时

首先你需要有一个服务器，一般这些服务器的商家都是会给新人送免费一个月的服务器，我的服务器就是从阿里云领的一个月，我选的系统是 linux 中的 centos（听说服务器大多是这个，虽然不知道好在哪里）

然后安装软件 xshell（学生是不用钱的，填一份表就是免费，所以大家还是支持正版吧），通过在 xshell 输入命令控制服务器

接下来用 xshell 连接好你的服务器

打开 xshell ，点击新建

![](/img/in-post/2021-11-2-lab-blog/8.png)

名称随便填，主机输入你服务器的公网 IP

![](/img/in-post/2021-11-2-lab-blog/9.png)

然后输入你服务器的用户名和密码，如果没有创建就先去创建

![](/img/in-post/2021-11-2-lab-blog/10.png)

然后点击坐下角的连接，如果出现类似下图的情况就是连接成功了

![](/img/in-post/2021-11-2-lab-blog/11.png)

接下来我们使用宝塔来安装一些必要的软件，宝塔使用起来非常方便，很推荐

复制以下命令进行安装（这是 centos 的，具体是什么应该看你服务器的系统，可以去官网查看命令）

```sh
yum install -y wget && wget -O install.sh http://download.bt.cn/install/install_6.0.sh && sh install.sh
```

安装完后，访问出现的外网地址输入给出的账号密码就能进入宝塔界面了（**记得先在安全组加入端口 8888 ，以后要用到的端口都要加入安全组，之后就不反复提了**）

![](/img/in-post/2021-11-2-lab-blog/12.png)

安装好初始提示你安装的软件，注意 **MySQL 版本最好和你本地的版本一致**

安装好后，点击标红部分新建 users 和 person 两张数据表

![](/img/in-post/2021-11-2-lab-blog/13.png)

接下来将 vue 项目打包，输入以下命令

```sh
npm run build:prod
```

将生成的 dist 文件夹里的文件复制到 SpringBoot 项目的 static 文件夹中

输入以下命令将 SpringBoot 项目打包

```sh
mvn clean package
```

将生成的 .jar 文件通过宝塔上传到服务器上

接下来要安装 jdk，**建议和本地一致，否则有可能报错**，对于低版本的 jdk 很容易，网上多的是，但是我竟然在中文互联网找不到 centos 如何安装 jdk17 ，最后还是谷歌输入英文找到的，具体可以参考以下链接：
[https://techviewleo.com/install-java-openjdk-on-rocky-linux-centos/](https://techviewleo.com/install-java-openjdk-on-rocky-linux-centos/)

最后输入以下命令，使服务器在终端退出后也保持后台运行项目就 ok 了

```sh
nohup java -jar backend-0.0.1-SNAPSHOT.jar &
```

先在你就可以通过访问你的服务器公网 IP 加上后端项目端口加上项目根目录访问到你的项目，例如我的地址就是：

[http://120.25.234.241:8080/admin/](http://120.25.234.241:8080/admin/)

有什么问题可以在下方留言或者联系我